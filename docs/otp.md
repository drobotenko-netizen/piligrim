openapi: 3.0.2
info:
  version: UPD 23.05.2025
  title: OTP Service
  description: |
    # Description
    The OTP service is a specialized function of our platform designed to send, create and verify one-time passwords (OTP) to users.
    
    A one-time password (OTP) is a unique, short-lived code (usually consisting of numbers) that is used to confirm the user's identity or intentions (for example, logging into an account or confirming a payment). It is valid only once and for a short time, which significantly increases security compared to regular static passwords.
    
    # Operating principles
    To use the service, you need:
    1) Sender names for the required channels.
    
    To send an OTP message, any sender names of supported channels that have an active status are suitable.
    2) OTP message templates created in the Dashboard.
      
    The OTP service requires the creation of an OTP template.
      
    The OTP template is created in the Dashboard, in the template designer, where, when creating a template, you must mark the template category.
    
    3) Setting up the service in your Dashboard.
      
    The OTP service supports many settings available in your Dashboard: https://my.messaggio.com/otp
      
    For most use cases, using default values is acceptable.
    # Errors
    
    | Code | Category | Subtypes |
    |-------|-----------------------------------|--------------------------------------------------------------------------------------------|
    | 1000 | Authentication error | access denied |
    | 1100 | Validation error | invalid channel, invalid code, invalid auth id, invalid phone number, unsupported country |
    | 1150 | Session state error | too many attempts, cooldown active, auth session is blocked |
    | 1200 | Critical error | settings are invalid or missing, missing settings for channel |
    | 2100 | Operation already in progress | operation in progress |
    | 2200 | Billing error | — |
    | 5000 | Internal service error | internal server error |
    
    > Detailed descriptions of subtypes are available in the `error_codes` schema specification.
    
    
servers:
  - url: https://otp.messaggio.com/api/v1/
security:
  - bearerAuth: []
tags:
  - name: OTP
paths:
  /phone/destinations:
    post:
      tags:
        - OTP
      operationId: getPhoneDestinations
      summary: Request available sending channels by phone number.
      description: | 
        The platform determines the country of the provided phone number and checks the settings specified in the dashboard for this direction.
        
        If the settings for this direction are found, a list of channels for this specific direction is returned.
        
        If the settings for this specific country are not found, a list of channels for the general direction is returned.
        
        The channels listed in the response to this request do not mean that these channels are available to the subscriber, but that they are capable of attempting verification in these channels.
      parameters:
        - $ref: "#/components/parameters/requestID"
      requestBody:
        $ref: "#/components/requestBodies/phoneDestinationsRequest"
      responses:
        "200":
          $ref: "#/components/responses/phoneDestinations"
        "429":
          $ref: "#/components/responses/tooManyRequests"
        "default":
          $ref: "#/components/responses/error"
  /code:
    post:
      tags:
        - OTP
      operationId: sendCode
      summary: Send one-time password
      description: |
        Upon receiving a request, the platform attempts to send a code to the subscriber according to the transmitted data.
        
        If the code field is not passed, the platform generates the code itself.
        
        If the channel field is not passed, the platform determines the channel according to the service settings.
      parameters:
        - $ref: "#/components/parameters/requestID"
      requestBody:
        $ref: "#/components/requestBodies/sendCodeRequest"
      responses:
        "202":
          $ref: "#/components/responses/processing"
        "429":
          $ref: "#/components/responses/tooManyRequests"
        "default":
          $ref: "#/components/responses/error"
  /code/verify:
    post:
      tags:
        - OTP
      operationId: verifyCode
      summary: Verify the code received from the subscriber
      description: |
        If the code was generated by the platform, this request allows you to check whether the code received from the subscriber matches the one actually sent.
      parameters:
        - $ref: "#/components/parameters/requestID"
      requestBody:
        $ref: "#/components/requestBodies/verifyCodeRequest"
      responses:
        "200":
          $ref: "#/components/responses/verified"
        "429":
          $ref: "#/components/responses/tooManyRequests"
        "default":
          $ref: "#/components/responses/error"
  /code/dlrs:
    post:
      tags:
        - OTP
      summary: Get delivery status
      operationId: getDLRS
      parameters:
        - $ref: "#/components/parameters/requestID"
      requestBody:
        $ref: "#/components/requestBodies/statusEventsRequest"
      responses:
        "200":
          $ref: "#/components/responses/deliveryReports"
        "429":
          $ref: "#/components/responses/tooManyRequests"
        "default":
          $ref: "#/components/responses/error"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: token
      x-ogen-use-client: true
      description: |
        The authorization token can be obtained on the service settings page in your personal account: https://my.messaggio.com/otp/general-settings
  headers:
    requestID:
      required: false
      allowEmptyValue: false
      schema:
        $ref: "#/components/schemas/requestID"
  parameters:
    requestID:
      description: |
        An optional field where you can pass a request ID for use in further analytics.
      required: false
      in: header
      name: X-Request-Id
      schema:
        $ref: "#/components/schemas/requestID"
  requestBodies:
    phoneDestinationsRequest:
      required: true
      content:
        application/json:
          schema:
            additionalProperties: false
            properties:
              phone:
                $ref: "#/components/schemas/phone"
            required:
              - phone
    sendCodeRequest:
      required: true
      content:
        application/json:
          schema:
            additionalProperties: false
            properties:
              to:
                $ref: "#/components/schemas/phone"
              channel:
                $ref: "#/components/schemas/channel"
              code:
                $ref: "#/components/schemas/code"
            required:
              - to
    verifyCodeRequest:
      required: true
      content:
        application/json:
          schema:
            additionalProperties: false
            properties:
              auth_id:
                $ref: "#/components/schemas/authID"
              code:
                $ref: "#/components/schemas/code"
            required:
              - auth_id
              - code
    statusEventsRequest:
      required: true
      content:
        application/json:
          schema:
            additionalProperties: false
            properties:
              auth_ids:
                type: array
                minItems: 1
                maxItems: 64
                items:
                  $ref: "#/components/schemas/authID"
            required:
              - auth_ids
  responses:
    error:
      description: Error
      headers:
        X-Request-Id:
          $ref: "#/components/headers/requestID"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/error"
    tooManyRequests:
      description: The phone number request limit has been exceeded.
      headers:
        Retry-After:
          description: |
            The number of seconds after which the request can be retried.
            Since rate limiting applies within one minute, this value ranges from 1 to 59.
            Conforms to [RFC 7231 § 7.1.3](https://tools.ietf.org/html/rfc7231#section-7.1.3).
          schema:
            type: integer
        X-Request-Id:
          $ref: "#/components/headers/requestID"
    phoneDestinations:
      description: Available channels.
      headers:
        X-Request-Id:
          $ref: "#/components/headers/requestID"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/phoneDestinations"
    processing:
      description: Accepted
      headers:
        X-Request-Id:
          $ref: "#/components/headers/requestID"
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              to:
                $ref: "#/components/schemas/phone"
              channel:
                $ref: "#/components/schemas/channel"
              auth_id:
                $ref: "#/components/schemas/authID"
              auth_ttl_seconds:
                type: integer
                minimum: 0
                example: 300
              can_send_after_seconds:
                type: integer
                minimum: 30
              created_at:
                $ref: "#/components/schemas/dateTime"
            required:
              - to
              - channel
              - auth_id
              - auth_ttl_seconds
              - can_send_after_seconds
              - created_at
    verified:
      description: Code verified.
      headers:
        X-Request-Id:
          $ref: "#/components/headers/requestID"
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              status:
                $ref: "#/components/schemas/verifyStatus"
              attempt:
                type: integer
                example: 1
              attempts_left:
                type: integer
                example: 0
            required:
              - status
              - attempt
              - attempts_left
    deliveryReports:
      headers:
        X-Request-Id:
          $ref: "#/components/headers/requestID"
      description: Delivery report.
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              codes:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  properties:
                    auth_id:
                      $ref: "#/components/schemas/authID"
                    to:
                      $ref: "#/components/schemas/phone"
                    delivery_reports:
                      type: array
                      items:
                        $ref: "#/components/schemas/deliveryReport"
                  required:
                    - auth_id
                    - to
                    - delivery_reports
            required:
              - codes
  schemas:
    error:
      description: Error response body.
      type: object
      additionalProperties: false
      properties:
        error:
          type: string
          example: "some_error_identity"
          description: Unique text error code.
        error_code:
          type: integer
          example: 10001
          description: Numeric code for the error.
        description:
          type: string
          example: "something went wrong"
          description: Error description.
      required:
        - error
        - error_code
        - description
    error_codes:
      type: object
      description: Reference guide of error codes with descriptions and subtypes.
      properties:
        1000:
          type: object
          description: Authentication error.
          properties:
            description:
              type: string
              example: "An error related to access to the service."
            subtypes:
              type: object
              properties:
                access_denied:
                  type: string
                  example: "access denied"
                  description: Occurs when the user does not have permission to perform an operation.
        1100:
          type: object
          description: Validation error
          properties:
            description:
              type: string
              example: "An error that occurs when the input data is invalid."
            subtypes:
              type: object
              properties:
                invalid_channel:
                  type: string
                  example: "The specified channel for sending the code is invalid or not supported"
                invalid_code:
                  type: string
                  example: "Invalid verification code format, does not match template or code is missing"
                invalid_auth_id:
                  type: string
                  example: "invalid authentication identifier format"
                invalid_phone_number:
                  type: string
                  example: "The phone number provided is invalid or does not meet the requirements"
                unsupported_country:
                  type: string
                  example: "The specified country is not supported by the system"
        1150:
          type: object
          description: Authentication session state error
          properties:
            description:
              type: string
              example: "An error that occurs when the session state does not allow the requested operation to be performed."
            subtypes:
              type: object
              properties:
                too_many_attempts:
                  type: string
                  example: "The allowed number of attempts to send the code has been exceeded"
                cooldown_active:
                  type: string
                  example: "The operation is temporarily blocked. A certain amount of time must pass after the previous attempt to send the code before the operation can be repeated."
                auth_session_is_blocked:
                  type: string
                  example: "the user's session is temporarily blocked. This happens, for example, after a successful code check, when the system blocks the session for a certain time to prevent abuse"
        1200:
          type: object
          description: Critical error
          properties:
            description:
              type: string
              example: "An error that prevents further operation of the service. May occur due to incorrectly specified settings.."
            subtypes:
              type: object
              properties:
                settings_are_invalid_or_missing:
                  type: string
                  example: "the service settings are invalid or missing. This makes further operation of the service impossible"
                missing_settings_for_channel:
                  type: string
                  example: "there are no settings for the specified code sending channel (e.g. SMS, Telegram). This makes it impossible to send the code through this channel"
        2100:
          type: object
          description: Error "Action already in progress"
          properties:
            description:
              type: string
              example: "An error occurs when a user attempts to perform an action that is already in progress."
            subtypes:
              type: object
              properties:
                operation_in_progress:
                  type: string
                  example: "Operation already in progress. Please try again later"
        2200:
          type: object
          description: Billing error
          properties:
            description:
              type: string
              example: ""
            subtypes:
              type: object
              properties: {}
        5000:
          type: object
          description: Internal service error
          properties:
            description:
              type: string
              example: "An error that occurs when there is an unexpected failure in the system.."
            subtypes:
              type: object
              properties:
                internal_server_error:
                  type: string
                  example: "internal service error. Please try again later or contact support."
    requestID:
      type: string
      example: "daf8b489bbb7"
      description: Request ID.
    phoneDestinations:
      type: object
      additionalProperties: false
      properties:
        phone:
          $ref: "#/components/schemas/phone"
        country_code:
          type: string
          description: |
            Country code, compliant to [ISO 3166-1 Alpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)
          example: US
        channels:
          type: array
          description: |
            An ordered list of available channels according to the configuration. An available channel is one that is explicitly specified for the recipient's country [in the template settings](https://my.messaggio.com/otp/templates-settings)
          uniqueItems: true
          items:
            $ref: "#/components/schemas/channel"
          example: [telegram, viber, whatsapp, sms]
      required:
        - phone
        - country_code
        - channels
    deliveryReport:
      type: object
      additionalProperties: false
      properties:
        status:
          $ref: "#/components/schemas/sendStatus"
        channel:
          $ref: "#/components/schemas/channel"
        created_at:
          $ref: "#/components/schemas/dateTime"
      required:
        - status
        - channel
        - created_at
    sendStatus:
      type: string
      enum:
        - SEND_SUCCESS
        - SEND_FAIL
        - SEND_FATAL
      example: SEND_FAIL
      description: |
        * `SEND_SUCCESS` - the code was successfully sent to the subscriber.
        * `SEND_FAIL` - failed to send (e.g. the channel for the country is blocked in the user settings). The code can be sent via the next available channel.
        * `SEND_FATAL` - sending error (e.g. insufficient funds on the balance).
    verifyStatus:
      type: string
      enum:
        - CODE_VERIFIED
        - CODE_INVALID
        - CODE_MAX_ATTEMPTS_EXCEEDED
        - CODE_EXPIRED
        - CODE_NOT_FOUND
      example: CODE_VERIFIED
      description: |
        * `CODE_VERIFIED` - the received code matches the code that was sent to the subscriber.
        * `CODE_INVALID` - the received code does not match the code that was sent to the subscriber.
        * `CODE_MAX_ATTEMPTS_EXCEEDED` - the maximum number of code verification attempts has been exceeded.
        * `CODE_EXPIRED` - the code has expired.
        * `CODE_NOT_FOUND` - the code was not sent.
    channel:
      type: string
      enum:
        - telegram
        - viber
        - whatsapp
        - sms
      example: telegram
      description: Designation of the channel. When passing this field, the platform ignores the channel prioritization settings by direction and sends the code to the specified channel.
    code:
      type: string
      example: 1234
      minLength: 4
      maxLength: 8
      pattern: '^\d{4,8}$'
      description: Verification code. When this field is passed, the platform does not generate a code on its own and sends the specified code.
    authID:
      type: string
      format: uuid
      example: "88c0bed5-8c7c-4906-8fca-daf8b489bbb7"
      description: Universal authentication session identifier, conforms to [RFC4122](https://www.rfc-editor.org/rfc/rfc4122).
    dateTime:
      type: string
      format: date-time
      description: |
        Date and time, complies with [RFC3339](https://www.rfc-editor.org/rfc/rfc3339)
      example: "2006-01-02T15:04:05Z07:00"
    phone:
      type: string
      description: Telephone number in international format.
      example: "+12819374192"
      pattern: '^\+?\d{5,15}$'