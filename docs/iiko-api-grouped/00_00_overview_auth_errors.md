---
title: Обзор, ограничения, авторизация, ошибки
source: https://ru.iiko.help/articles/#!api-documentations/iikoserver-api
generated: 2025-09-29T09:20:40.638Z
---

# Обзор, ограничения, авторизация, ошибки

## Оглавление

---

# iiko Server API (ru.iiko.help) — выгрузка

Источник: https://ru.iiko.help/articles/#!api-documentations/iikoserver-api

Облачные системы с открытым API всегда имеют ограничения по использованию, чтобы предоставлять клиентам максимально надежный и стабильный сервис. 

Ниже находится список ограничений для работы с iikoServer: 

Запросы должны выполнятся последовательно друг за другом. Каждый следующий запрос должен быть отправлен только после того, как выполнился предыдущий запрос.
Запрашивайте данные за период не длиннее одного месяца, в идеале — за один день или неделю. 
Принципы работы
Отдельные сущности представляются в виде XML-документа. XML схема каждой сущности представлена в приложении.
Списки сущностей представлены в виде XML-документа, корневой элемент которого содержит XML-элементы, представляющие сущности.
Создание и изменение сущностей методом POST осуществляется передачей в качестве параметров запроса аттрибутов сущности. Таким образом возможно внесение изменений лишь в определённые поля без передачи неизменяемых значений. В заголовке запроса должен быть указан: Content-Type: application/x-www-form-urlencoded
Создание и изменение сущностей методом PUT осуществляется передачей в теле запроса самой сущности. Аттрибуты сущности, отсутствующие в теле запроса, примут значение по-умолчанию в случае создания сущности и сохранят свои значения в случае обновления. В заголовке запроса необходимо указывать : Content-Type: application/xml
При успешном создании сущности будет возвращён ответ с HTTP-статусом 201 (Created).
При успешном обновлении сущности будет возвращён ответ с HTTP-статусом 200 (OK).

Авторизация
### POST Request	 https://host:port/resto/api/auth?login=[login]&pass=[sha1passwordhash]
#### Пример запроса

https://localhost:8080/resto/api/auth?login=admin&pass=2155245b2c002a1986d3f384af93be813537a476

#### Параметры запроса

Параметр
Описание
login

Логин пользователя

pass

SHA1 hash от пароля

в bash его можно получить так: printf "resto#test" | sha1sum

#### Что в ответе

Строка-токен, который необходимо передавать как cookie с именем key или как параметр key всех запросов.

Начиная с 4.3 сервер сам устанавливает cookie key.

Выход
### POST Request	  https://host:port/resto/api/logout?key=[token]
#### Что в ответе

Строка-токен, полученная при авторизации. 

#### Пример запроса

https://localhost:8080/resto/api/logout?key=b354d18c-3d3a-e1a6-c3b9-9ef7b5055318

https://localhost:8080/resto/api/logout c cookie key=c0508074-a052-6276-bf72-871f7acb865e

Описание ошибок
Любой метод серверного REST API v1 и REST API v2 вместо ответа в задокументированном формате может вернуть одну из следующих ошибок с телом text/plain:

HTTP code
Значение, описание, параметры
Ожидаемое поведение клиента/интеграции
403	
Доступ запрещён (аутентифицирован, но нет прав):

На сервере нет лицензии на данный API или подсистему API (сотрудников, событий...)
(Module %s is blocked within current license)
Превышено разрешенное количество подключений к API или подсистеме API
(License enhancement is required: no connections available for module %s)
У вошедшего пользователя нет прав, требуемых конкретным модулем API
(Permission denied)
Уведомить пользователя (внимание: текст ошибки не локализован) 
400	
Либо ошибка в запросе (параметры не того типа, ошибки десериализации), либо внутренняя ошибка, связанная с неполнотой полученных в запросе, либо хранящихся в базе данных:

Wrong date format: 2019-0513 15:26
1)Получить кол-во свободных слотов для конкретного лицензионного модуля можно запросом http://localhost:8080/resto/api/licence/info?moduleId=28008806

Все тело ответа в формате Content-type: text/plain является текстом ошибки, который рекомендуется вывести пользователю (при получении статуса 409) и записать в свой лог для упрощения поддержки (при получении любого http-статуса). Тип ответа, содержащий html (text/html, text/xhtml и т.п), говорит о сетевой ошибке или ошибке настройки сервера (опечатка в URL, ошибка DNS, ошибка настроек прокси, "пустой" Tomcat без сервера RMS/Chain и т.п.), реже о рестарте сервера.

Если выше не указано явно (в частности, код 409), текст ошибки не локализован и может содержать технические детали (UUID-ы затронутых объектов).

Текст может содержать обязательные переносы строк, то есть, рассчитан на вывод в режиме CSS "white-space: pre-line;".

Текст не экранирован и может содержать "опасные" для js, html, sql, etc символы.

Лог сервера (full.log, access.csv) может содержать больше информации, чем доступно пользователю API. Это включает в себя не только детали произошедших ошибок/отказов, но и "предупреждений" (WARN).

Авторизационные данные транзакции

Поле
Описание
user	UUID пользователя.
card	Номер карты.
causeEvenId	UUID события оплаты заказа.
cashierId	UUID кассира, совершившего проводку.
departmentId	UUID торгового предприятия.
cashFlowCategory	
Статья движения денежных средств (ДДС).

Поле
Описание
code	Код.
parentCategory	
Родительская статья ДДС.

type	
 

Тип деятельности:

OPERATIONAL (операционная)
INVESTMENT (инвестиционная)
FINANCE (финансовая)
 

actualSum	
Сумма из элемента документа закрытия кассовой смены соответствующего данным проводки

или сумма из проводки, если такового не нашлось.

originalSum	Сумма проводки.
editedPayAccountId 	
Счет из элемента документа закрытия кассовой смены соответствующего данным проводки

или сумма из проводки, если такового не нашлось. Редактируемый счет.

originalPayAccountId	Счет, значение которого совпадает с editedPayAccountId.
payAgentId	
Контрагент из элемента документа закрытия смены соответствующего данным проводки или

из транзакции, если такого элемента не нашлось.

paymentTypeId	Тип оплаты.
editableComment	Комментарий.
#### Пример запроса и результата

Запрос

Статья по авторизации для работы с методами API iikoServer.

Строка-токен, получаемый при авторизации
#### Тело запроса
Код
{
    "reportType": "SALES",
    "groupByRowFields": [
            "OpenDate.Typed",
            "SessionNum",
            "OpenTime",
            "CloseTime",
            "DishName",
            "OrderType",
            "Delivery.CustomerName",
            "Delivery.CustomerPhone",
            "PayTypes"
    ],
    "groupByColFields": [],
    "aggregateFields": [
        "DishSumInt"
    ],
    "filters": {
        "OpenDate.Typed": {
            "filterType": "DateRange",
            "periodType": "CUSTOM",
            "from": "2025-03-01T00:00:00.000",
            "to": "2025-03-31T00:00:00.000"
            
        },