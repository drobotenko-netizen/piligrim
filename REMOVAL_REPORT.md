# –û—Ç—á–µ—Ç –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ Messaggio OTP –∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –£–¥–∞–ª–µ–Ω–∏–µ Messaggio OTP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚ùå –£–¥–∞–ª–µ–Ω —Ñ–∞–π–ª `server/src/modules/auth/otp.ts`
- ‚ùå –£–¥–∞–ª–µ–Ω—ã endpoints `/api/auth/otp/send` –∏ `/api/auth/otp/verify`
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `MESSAGGIO_API_KEY` –∏ `MESSAGGIO_BASE_URL`
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ SMS —Å–µ—Ä–≤–∏—Å–∞

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `server/src/modules/auth/auth.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã endpoints:
  - `GET /api/auth/_ping` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
  - `GET /api/auth/me` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
  - `POST /api/auth/dev-login` - DEV –≤—Ö–æ–¥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  - `POST /api/auth/logout` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
  - `POST /api/auth/telegram-bind` - –ø—Ä–∏–≤—è–∑–∫–∞ Telegram (DEV)

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `server/src/index.ts` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ auth —Ä–æ—É—Ç–µ—Ä–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cookie –≤ `magic.ts`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã TypeScript –æ—à–∏–±–∫–∏ –≤ `iiko/router.ts`

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `client/src/components/HomeRedirect.tsx`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `client/src/components/sidebar.tsx`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `sales/customers` –∏ `sales/revenue`
- ‚úÖ –í—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `/api/auth/otp/*` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `/api/auth/*`

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `docs/env.md` - —É–¥–∞–ª–µ–Ω—ã Messaggio –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω `AUTH_TESTING_GUIDE.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test-auth-flow.js`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ API endpoints
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±—ç–∫–µ–Ω–¥–∞

## üîÑ –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞:
1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –≤ —Å–∏—Å—Ç–µ–º–µ
2. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start <–∫–æ–¥_–ø—Ä–∏–≤—è–∑–∫–∏>`** –±–æ—Ç—É
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/login`** –±–æ—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –≤—Ö–æ–¥–∞
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ** –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è

### DEV —Ä–µ–∂–∏–º (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
- –î–æ—Å—Ç—É–ø–µ–Ω endpoint `/api/auth/dev-login` –¥–ª—è –≤—Ö–æ–¥–∞ –±–µ–∑ Telegram
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å ADMIN –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üìã API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ endpoints:
- `GET /api/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- `GET /api/auth/_ping` - –ø—Ä–æ–≤–µ—Ä–∫–∞ auth –º–æ–¥—É–ª—è
- `POST /api/auth/dev-login` - DEV –≤—Ö–æ–¥
- `GET /api/auth/magic/callback` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ magic links
- `GET /api/auth/magic/s/:id` - –∫–æ—Ä–æ—Ç–∫–∏–µ magic links
- `POST /api/telegram/webhook` - webhook –¥–ª—è Telegram

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints:
- `GET /api/auth/me` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `POST /api/auth/logout` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ `/api/*` endpoints

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
‚úÖ Health endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Auth ping endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ /me endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Dev login endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Logout endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤:
- ‚úÖ Backend (–ø–æ—Ä—Ç 4000): —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Frontend (–ø–æ—Ä—Ç 3000): —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript: —É—Å–ø–µ—à–Ω–∞
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è Next.js: —É—Å–ø–µ—à–Ω–∞

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –£–¥–∞–ª–µ–Ω—ã:
```env
MESSAGGIO_API_KEY=...
MESSAGGIO_BASE_URL=...
```

### –û—Å—Ç–∞–ª–∏—Å—å:
```env
AUTH_JWT_SECRET=<–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å-256-–±–∏—Ç-—Å–µ–∫—Ä–µ—Ç>
MAGIC_LINK_SECRET=<–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å-256-–±–∏—Ç-—Å–µ–∫—Ä–µ—Ç>
TELEGRAM_BOT_TOKEN=<–≤–∞—à-—Ç–æ–∫–µ–Ω-–±–æ—Ç–∞>
TELEGRAM_POLLING=1
SERVER_PUBLIC_URL=http://localhost:4000
FRONTEND_BASE_URL=http://localhost:3000
```

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

1. **–°–µ—Ä–≤–µ—Ä –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –±–µ–∑ –æ—à–∏–±–æ–∫
2. **–ö–ª–∏–µ–Ω—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –±–µ–∑ –æ—à–∏–±–æ–∫  
3. **–í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞** –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
5. **Magic links —Ä–∞–±–æ—Ç–∞—é—Ç** –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
6. **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞** —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
2. **–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —á–µ—Ä–µ–∑ admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π flow** —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram –±–æ—Ç–æ–º
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è production

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **Messaggio –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω** - –Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö SMS —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram** - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- **DEV —Ä–µ–∂–∏–º –¥–æ—Å—Ç—É–ø–µ–Ω** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ Telegram
- **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–ª—Å—è —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞

---

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**  
**–î–∞—Ç–∞:** $(date)  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2 —á–∞—Å–∞
